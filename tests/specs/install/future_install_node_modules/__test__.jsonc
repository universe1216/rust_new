{
  "tests": {
    "install_sets_up_node_modules": {
      "tempDir": true,
      "envs": {
        "DENO_FUTURE": "1"
      },
      "steps": [
        {
          "args": "install",
          "output": "install.out"
        },
        {
          // ensure deps are actually cached
          "args": "run --cached-only main.js",
          "output": ""
        },
        {
          // check for lockfile
          "args": [
            "eval",
            "console.log(Deno.readTextFileSync('./deno.lock').trim())"
          ],
          "output": "deno.lock.out"
        }
      ]
    },
    "install_errors_corrupted_lockfile": {
      "tempDir": true,
      "envs": {
        "DENO_FUTURE": "1"
      },
      "steps": [
        {
          "args": "install",
          "output": "install.out"
        },
        {
          // Mess up the lockfile
          "args": [
            "run",
            "-A",
            "corrupt.js"
          ],
          "output": ""
        },
        {
          // Run the install again
          "args": "install",
          "output": "corrupted.out",
          "exitCode": 10
        }
      ]
    }
  }
}
